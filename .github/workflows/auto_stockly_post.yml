# GitHub Actions workflow to call your /auto_stockly_post endpoint every 8 hours (3x/day)
# - Schedule: '0 */8 * * *' runs at 00:00, 08:00 and 16:00 UTC.
# - Use repository secrets: API_URL (full URL to call) and POST_TOKEN (exact Authorization header value).
name: Auto Stockly Post (every 8 hours)

on:
  schedule:
    - cron: '0 */8 * * *'
  workflow_dispatch: {} # allows manual runs from the Actions UI

jobs:
  post:
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - name: Call /auto_stockly_post with retries
        env:
          API_URL: ${{ secrets.API_URL }}
          POST_TOKEN: ${{ secrets.POST_TOKEN }}
          MAX_ATTEMPTS: 3
          SLEEP_BETWEEN: 10
        run: 
          "curl --location --globoff '$API_URL' --header 'Authorization: $POST_TOKEN'"
